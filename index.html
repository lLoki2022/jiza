<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Image Generator</title>
</head>
<body>
    <h1>Dynamic Image Generator</h1>
    <form id="imageForm">
        <label for="imageUrl">Image URL:</label>
        <input type="text" id="imageUrl" name="imageUrl" placeholder="Enter image URL">
        <br>
        <label for="textToAdd">Text to Add:</label>
        <input type="text" id="textToAdd" name="textToAdd" placeholder="Enter text">
        <br>
        <label for="xCoord">X Coordinate:</label>
        <input type="number" id="xCoord" name="xCoord" placeholder="X coordinate">
        <label for="yCoord">Y Coordinate:</label>
        <input type="number" id="yCoord" name="yCoord" placeholder="Y coordinate">
        <br>
        <button type="submit">Generate Image</button>
    </form>
    <div id="generatedLink"></div>
    <div id="imageContainer"></div>

    <script>
        // Function to generate image
        function generateImage(imageUrl, textToAdd, xCoord, yCoord) {
            var img = new Image();
            img.onload = function() {
                var imageContainer = document.getElementById("imageContainer");
                imageContainer.innerHTML = "";
                imageContainer.appendChild(img);

                // Check if the coordinates are within image bounds
                var maxWidth = img.width;
                var maxHeight = img.height;
                if (xCoord < 0) xCoord = 0;
                if (xCoord > maxWidth) xCoord = maxWidth;
                if (yCoord < 0) yCoord = 0;
                if (yCoord > maxHeight) yCoord = maxHeight;

                var textElement = document.createElement("div");
                textElement.style.position = "absolute";
                textElement.style.left = xCoord + "px";
                textElement.style.top = yCoord + "px";
                textElement.textContent = textToAdd;
                imageContainer.appendChild(textElement);

                // Generate the link with parameters
                var params = "imageUrl=" + encodeURIComponent(imageUrl) +
                             "&textToAdd=" + encodeURIComponent(textToAdd) +
                             "&xCoord=" + xCoord +
                             "&yCoord=" + yCoord;
                var url = "?" + params;
                var generatedLink = document.getElementById("generatedLink");
                generatedLink.innerHTML = "Вы можете развернуть этот код на вашем сервере, а затем использовать ссылку вида: <br><code>" + window.location.origin + url + "</code><br>для генерации и отображения изображения с примененными параметрами. Просто скопируйте эту ссылку и вставьте ее туда, где вам нужно.";
            };
            img.src = imageUrl;
        }

        // Function to handle form submission
        document.getElementById("imageForm").addEventListener("submit", function(event) {
            event.preventDefault();
            var imageUrl = document.getElementById("imageUrl").value;
            var textToAdd = document.getElementById("textToAdd").value;
            var xCoord = parseInt(document.getElementById("xCoord").value);
            var yCoord = parseInt(document.getElementById("yCoord").value);

            generateImage(imageUrl, textToAdd, xCoord, yCoord);
        });

        // Extract parameters from URL
        window.onload = function() {
            var urlParams = new URLSearchParams(window.location.search);
            var imageUrl = urlParams.get('imageUrl');
            var textToAdd = urlParams.get('textToAdd');
            var xCoord = parseInt(urlParams.get('xCoord')) || 0;
            var yCoord = parseInt(urlParams.get('yCoord')) || 0;

            // Set form fields
            document.getElementById("imageUrl").value = imageUrl || "";
            document.getElementById("textToAdd").value = textToAdd || "";
            document.getElementById("xCoord").value = xCoord;
            document.getElementById("yCoord").value = yCoord;

            // Generate image if parameters are present
            if (imageUrl && textToAdd && !isNaN(xCoord) && !isNaN(yCoord)) {
                generateImage(imageUrl, textToAdd, xCoord, yCoord);
            }
        };
    </script>
</body>
</html>
